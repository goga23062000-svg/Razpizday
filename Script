-- Free Camera for Roblox (Compact)
local Players, UIS, RS, TS = game:GetService("Players"), game:GetService("UserInputService"), game:GetService("RunService"), game:GetService("TweenService")
local player, camera = Players.LocalPlayer, workspace.CurrentCamera

-- Settings
local cfg = {speed = 10, fast = 25, sens = 0.5, touchSens = 0.3}
local isMobile = UIS.TouchEnabled

-- State
local cam = {enabled = false, pos = Vector3.new(), rot = Vector2.new(), ogType = Enum.CameraType.Custom}

-- UI
local gui, toggleBtn, tpBtn, mobileUI
local joyVec = Vector3.new()

-- Create UI
local function createUI()
    if gui then gui:Destroy() end
    
    gui = Instance.new("ScreenGui")
    gui.Name = "FreeCamUI"
    gui.Parent = player.PlayerGui
    gui.ResetOnSpawn = false
    
    -- Toggle Button
    toggleBtn = Instance.new("TextButton")
    toggleBtn.Size = UDim2.new(0, 140, 0, 36)
    toggleBtn.Position = UDim2.new(0, 15, 0, 15)
    toggleBtn.BackgroundColor3 = Color3.fromRGB(70, 130, 180)
    toggleBtn.Text = "FREE CAMERA"
    toggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    toggleBtn.Font = Enum.Font.GothamBold
    toggleBtn.ZIndex = 10
    toggleBtn.Parent = gui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = toggleBtn
    
    -- Teleport Button
    tpBtn = Instance.new("TextButton")
    tpBtn.Size = UDim2.new(0, 140, 0, 36)
    tpBtn.Position = UDim2.new(0, 15, 0, 60)
    tpBtn.BackgroundColor3 = Color3.fromRGB(100, 180, 100)
    tpBtn.Text = "TELEPORT HERE"
    tpBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    tpBtn.Font = Enum.Font.GothamBold
    tpBtn.Visible = false
    tpBtn.ZIndex = 10
    tpBtn.Parent = gui
    
    local corner2 = Instance.new("UICorner")
    corner2.CornerRadius = UDim.new(0, 6)
    corner2.Parent = tpBtn
    
    -- Mobile Controls
    if isMobile then
        mobileUI = Instance.new("Frame")
        mobileUI.Size = UDim2.new(1, 0, 1, 0)
        mobileUI.BackgroundTransparency = 1
        mobileUI.Visible = false
        mobileUI.ZIndex = 5
        mobileUI.Parent = gui
        
        -- Joystick
        local joy = Instance.new("Frame")
        joy.Size = UDim2.new(0, 100, 0, 100)
        joy.Position = UDim2.new(0, 30, 1, -140)
        joy.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
        joy.BackgroundTransparency = 0.4
        joy.ZIndex = 6
        joy.Parent = mobileUI
        
        local joyCorner = Instance.new("UICorner")
        joyCorner.CornerRadius = UDim.new(1, 0)
        joyCorner.Parent = joy
        
        local joyHandle = Instance.new("Frame")
        joyHandle.Size = UDim2.new(0, 40, 0, 40)
        joyHandle.Position = UDim2.new(0.5, -20, 0.5, -20)
        joyHandle.BackgroundColor3 = Color3.fromRGB(100, 150, 200)
        joyHandle.BackgroundTransparency = 0.3
        joyHandle.ZIndex = 7
        joyHandle.Parent = joy
        
        local handleCorner = Instance.new("UICorner")
        handleCorner.CornerRadius = UDim.new(1, 0)
        handleCorner.Parent = joyHandle
        
        -- Touch Area
        local touchZone = Instance.new("Frame")
        touchZone.Size = UDim2.new(0.4, 0, 0.6, 0)
        touchZone.Position = UDim2.new(0.6, 0, 0.2, 0)
        touchZone.BackgroundTransparency = 1
        touchZone.ZIndex = 6
        touchZone.Parent = mobileUI
        
        -- Buttons
        local function addBtn(text, pos, color)
            local btn = Instance.new("TextButton")
            btn.Size = UDim2.new(0, 50, 0, 50)
            btn.Position = pos
            btn.BackgroundColor3 = color
            btn.BackgroundTransparency = 0.4
            btn.Text = text
            btn.TextColor3 = Color3.fromRGB(255, 255, 255)
            btn.Font = Enum.Font.GothamBold
            btn.ZIndex = 6
            btn.AutoButtonColor = false
            btn.Parent = mobileUI
            
            local btnCorner = Instance.new("UICorner")
            btnCorner.CornerRadius = UDim.new(0, 6)
            btnCorner.Parent = btn
            
            return btn
        end
        
        local upBtn = addBtn("↑", UDim2.new(1, -70, 0, 20), Color3.fromRGB(80, 180, 80))
        local downBtn = addBtn("↓", UDim2.new(1, -70, 0, 80), Color3.fromRGB(180, 80, 80))
        local speedBtn = addBtn("⚡", UDim2.new(1, -70, 1, -140), Color3.fromRGB(180, 150, 50))
        
        -- Touch Events
        local joyActive, joyCenter, joyTouch
        joy.InputBegan:Connect(function(i)
            if i.UserInputType == Enum.UserInputType.Touch then
                joyActive = true
                joyCenter = i.Position
                joyTouch = i
            end
        end)
        
        joy.InputEnded:Connect(function(i)
            if i == joyTouch then
                joyActive = false
                TS:Create(joyHandle, TweenInfo.new(0.2), {Position = UDim2.new(0.5, -20, 0.5, -20)}):Play()
                joyVec = Vector3.new()
            end
        end)
        
        UIS.InputChanged:Connect(function(i)
            if joyActive and i.UserInputType == Enum.UserInputType.Touch and i == joyTouch then
                local delta = i.Position - joyCenter
                local dist = math.min(delta.Magnitude, 40)
                if dist > 5 then
                    local dir = delta.Unit
                    joyVec = Vector3.new(dir.X, 0, dir.Y)
                    joyHandle.Position = UDim2.new(0.5 + dir.X*0.4, -20, 0.5 + dir.Y*0.4, -20)
                end
            end
        end)
        
        -- Store mobile state
        mobileUI.joyVec = function() return joyVec end
        mobileUI.upBtn = upBtn
        mobileUI.downBtn = downBtn
        mobileUI.speedBtn = speedBtn
        mobileUI.touchZone = touchZone
    end
    
    -- Events
    toggleBtn.MouseButton1Click:Connect(function() toggleCam() end)
    tpBtn.MouseButton1Click:Connect(function() teleport() end)
end

-- Toggle Camera
local function toggleCam()
    cam.enabled = not cam.enabled
    
    if cam.enabled then
        cam.ogType = camera.CameraType
        cam.pos = camera.CFrame.Position
        cam.rot = Vector2.new(
            math.atan2(camera.CFrame.LookVector.Z, camera.CFrame.LookVector.X),
            math.asin(camera.CFrame.LookVector.Y)
        )
        
        camera.CameraType = Enum.CameraType.Scriptable
        tpBtn.Visible = true
        toggleBtn.BackgroundColor3 = Color3.fromRGB(50, 180, 100)
        toggleBtn.Text = "FREE CAM [ON]"
        
        if isMobile and mobileUI then
            mobileUI.Visible = true
        else
            UIS.MouseBehavior = Enum.MouseBehavior.LockCenter
            UIS.MouseIconEnabled = false
        end
        
        notify("Free Camera ON", Color3.fromRGB(100, 255, 100))
    else
        camera.CameraType = cam.ogType
        tpBtn.Visible = false
        toggleBtn.BackgroundColor3 = Color3.fromRGB(70, 130, 180)
        toggleBtn.Text = "FREE CAMERA"
        
        if isMobile and mobileUI then
            mobileUI.Visible = false
        else
            UIS.MouseBehavior = Enum.MouseBehavior.Default
            UIS.MouseIconEnabled = true
        end
        
        notify("Free Camera OFF", Color3.fromRGB(255, 100, 100))
    end
end

-- Teleport
local function teleport()
    if not cam.enabled then
        notify("Turn on Free Cam first!", Color3.fromRGB(255, 200, 50))
        return
    end
    
    local char = player.Character
    if char then
        local hrp = char:FindFirstChild("HumanoidRootPart")
        if hrp then
            hrp.CFrame = CFrame.new(cam.pos)
            notify("Teleported!", Color3.fromRGB(100, 200, 255))
        end
    end
end

-- Notify
local function notify(msg, color)
    local note = Instance.new("TextLabel")
    note.Size = UDim2.new(0, 280, 0, 40)
    note.Position = UDim2.new(0.5, -140, 0, 20)
    note.AnchorPoint = Vector2.new(0.5, 0)
    note.BackgroundColor3 = color
    note.BackgroundTransparency = 0.3
    note.Text = msg
    note.TextColor3 = Color3.fromRGB(255, 255, 255)
    note.Font = Enum.Font.GothamBold
    note.ZIndex = 20
    note.Parent = gui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = note
    
    TS:Create(note, TweenInfo.new(0.5), {
        BackgroundTransparency = 1,
        TextTransparency = 1
    }):Play()
    
    game:GetService("Debris"):AddItem(note, 2)
end

-- Camera Update
RS.RenderStepped:Connect(function(dt)
    if not cam.enabled then return end
    
    local input = Vector3.new()
    local speed = cfg.speed
    local rotDelta = Vector2.new()
    
    -- PC Controls
    if not isMobile then
        if UIS:IsKeyDown(Enum.KeyCode.W) then input += Vector3.new(0,0,-1) end
        if UIS:IsKeyDown(Enum.KeyCode.S) then input += Vector3.new(0,0,1) end
        if UIS:IsKeyDown(Enum.KeyCode.A) then input += Vector3.new(-1,0,0) end
        if UIS:IsKeyDown(Enum.KeyCode.D) then input += Vector3.new(1,0,0) end
        if UIS:IsKeyDown(Enum.KeyCode.E) then input += Vector3.new(0,1,0) end
        if UIS:IsKeyDown(Enum.KeyCode.Q) then input += Vector3.new(0,-1,0) end
        if UIS:IsKeyDown(Enum.KeyCode.LeftShift) then speed = cfg.fast end
        
        local mouseDelta = UIS:GetMouseDelta()
        rotDelta = Vector2.new(mouseDelta.X, mouseDelta.Y)
        
    -- Mobile Controls
    else
        if mobileUI then
            input += mobileUI.joyVec()
            if mobileUI.upBtn then
                if UIS:IsMouseButtonPressed(Enum.UserInputType.Touch) and UIS:GetMouseLocation().X > ScrW()*0.7 then
                    input += Vector3.new(0,1,0)
                end
            end
            if mobileUI.speedBtn then
                if UIS:IsMouseButtonPressed(Enum.UserInputType.Touch) then
                    local mousePos = UIS:GetMouseLocation()
                    local speedPos = mobileUI.speedBtn.AbsolutePosition
                    local speedSize = mobileUI.speedBtn.AbsoluteSize
                    if mousePos.X >= speedPos.X and mousePos.X <= speedPos.X + speedSize.X and
                       mousePos.Y >= speedPos.Y and mousePos.Y <= speedPos.Y + speedSize.Y then
                        speed = cfg.fast
                    end
                end
            end
            
            -- Simple touch rotation (basic implementation)
            if UIS:IsMouseButtonPressed(Enum.UserInputType.Touch) then
                local mousePos = UIS:GetMouseLocation()
                if mousePos.X > ScrW()/2 then
                    rotDelta = Vector2.new(1, 0) * 30 * dt
                end
            end
        end
    end
    
    -- Apply rotation
    cam.rot = Vector2.new(
        cam.rot.X - rotDelta.X * (isMobile and cfg.touchSens or cfg.sens) * 0.01,
        math.clamp(cam.rot.Y - rotDelta.Y * (isMobile and cfg.touchSens or cfg.sens) * 0.01, -1.4, 1.4)
    )
    
    -- Apply movement
    if input.Magnitude > 0 then
        input = input.Unit
    end
    
    local move = CFrame.fromEulerAnglesYXZ(cam.rot.Y, cam.rot.X, 0):VectorToWorldSpace(input * speed * dt)
    cam.pos += move
    
    -- Update camera
    camera.CFrame = CFrame.new(cam.pos) * CFrame.fromEulerAnglesYXZ(cam.rot.Y, cam.rot.X, 0)
end)

-- Hotkeys
UIS.InputBegan:Connect(function(input, processed)
    if processed then return end
    if input.KeyCode == Enum.KeyCode.F5 then toggleCam() end
    if input.KeyCode == Enum.KeyCode.F6 and cam.enabled then teleport() end
end)

-- Init
if player then
    createUI()
    notify("Free Camera Loaded! Press F5", Color3.fromRGB(100, 200, 255))
else
    Players.PlayerAdded:Wait()
    player = Players.LocalPlayer
    createUI()
end

player.CharacterAdded:Connect(function()
    wait(0.3)
    createUI()
end)

print("FreeCam by sherik loaded")
